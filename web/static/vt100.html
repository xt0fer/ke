<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script type='text/javascript' src='/static/jquery.min.js'></script>
    <script type='text/javascript' src='/static/vt100.js'></script>
    <link rel="stylesheet" href="/static/style.css">
</head>

<body>
    <div class="border border-warning">
        <pre id="terminal"></pre>
    </div>
    <script>
        let socket = new WebSocket("ws://localhost:8005/editor");
        //let term = new jsvt.Terminal();
        let vt100 = new VT100(80, 25, "terminal")
        vt100.clear();
        vt100.refresh();

        let isr = function(ch, vt) {
            console.log(">ch", ch)
            socket.send(ch);
        };
        vt100.getch(isr);
        vt100.curs_set(true, false);
        VT100.the_vt_ = vt100

        socket.onopen = function() {
            $(window).on("keydown", function(event) {
                // let gets = term.InputString(event);
                // if (event.key != "Control") {
                //     socket.send(gets);
                // }
                if (event.keyCode === 17 || event.KeyCode === 18) {
                    console.log(">ev control or alt", event)
                } else {
                    ch = VT100.handle_event_(event);
                    console.log(">ev", event)
                    socket.send(ch);
                    console.log(">sending", ch)
                }
            });
        };
        socket.onmessage = function(e) {
            vt100.write(e.data);
            //$("#terminal").append(vt100.display);
        };
    </script>
</body>

</html>